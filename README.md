# EPPI_ddg
Pedicting $$\Delta\Delta G$$ with EPPI features. EPPI_ddg has a Pearson correlation coefficient of 0.72 with experimental $$\Delta\Delta G$$ values on a blind validation set.

# Dependencies
## Rosetta
EPPI_ddg requires Rosetta. To obtain Rosetta, navigate to https://github.com/RosettaCommons/rosetta and follow the instructions to download and compile. Namely, you will need to clone the repository:
```
cd /PATH/TO/ROSETTA/LOCATION/
git clone https://github.com/RosettaCommons/rosetta
```
Then, navigate to the Rosetta directory and compile:
```
cd rosetta/source
./scons.py -j<NumOfJobs> mode=release bin
```
## Eigen
Eigen is provided with the distribution in the external directory of PANTZ. No additional installation is required.

## Dunbrack Rotamer Library
The Dunbrack rotamer library is provided with the distribution in the external directory of PANTZ. No additional installation is required.

## Python
EPPI_ddg requires Python becuase the model was trained in sklearn and saved as a joblib file. The following packages are required:
```
pip3 install joblib==1.4.2
```

## C++
The code to calculate the EPPI features is written in C++ and requires a C++ compiler. The code was tested with g++ version 9.3.0 and Apple clang version 16.0.0 (clang-1600.0.26.6)

# Installation and Usage
To download and install EPPI_ddg, navigate to your working directory:
```
cd /PATH/TO/WORKING/DIRECTORY/
```
Then, clone the repository: 
```
git clone https://github.com/alanclayrichard/EPPI_ddg_test.git
```
Next, change the paths to the current PANTZ and Rosetta in the PANTZ/source/Macros.h file:
``` 
// define the path to PANTZ which sets the paths to the PANTZ, rotamer lirbary, and Eigen
#define PANTZ_PATH "/PATH/TO/EPPI_ddg/PANTZ/"
// path to rosetta executables
#define ROSETTA_MIN_exec "/PATH/TO/ROSETTA/LOCATION/rosetta/source/bin/minimize.default.macosclangrelease"
#define ROSETTA_RIA_exec "/PATH/TO/ROSETTA/LOCATION/rosetta/source/bin/InterfaceAnalyzer.default.macosclangrelease"
#define ROSETTA_REB_exec "/PATH/TO/ROSETTA/LOCATION/rosetta/source/bin/residue_energy_breakdown.default.macosclangrelease"
```

## Single State Model
Then, compile the code to predict the effects of a mutation using the single state model:
```
g++ predict_ddg.cpp -std=c++11 -o eppi_ddg
```
Finally, predict the effects of a mutation:
```
./eppi_ddg <file> <mutation> <interface> <output_path>
```
Where:

`<file>` is the PDB file (e.g. example/inputs/1A22.pdb)

`<mutation>` is the mutation in the form <old_res><chain><res_num><new_res> (e.g. QB416A)

`<interface>` is the chains that define the interface separated by _ (e.g. A_B)

`<output_path>` is the path to deposit the various output files generated (e.g. example/output)

## Ensemble Model
Using the ensemble model requires the generation of an ensemble of mutated structures, which can be done with any method of your choice. The ensemble generation performed in the reference study was performed using Rosetta's backrub protcol as implemented in the flex_ddg application. To generate an ensemble using flex_ddg, follow the instructions in the [flex_ddg](https://github.com/Kortemme-Lab/flex_ddG_tutorial.git) repository.

Then, place the ensemble of structures in a directory. The ensemble should be in the form of any number of PDB files containing the mutated structures. When the ensemble is generated, compile the code to predict the effects of a mutation using the ensemble model:
```
g++ predict_ddg_ensemble.cpp -std=c++11 -o eppi_ddg_ensemble
```
Finally, predict the effects of a mutation:
```
./eppi_ddg_ensemble <file> <mutation> <interface> <ensemble_path>
```
Where:

`<file>` is the PDB file (e.g. example/inputs/1A22.pdb)

`<mutation>` is the mutation in the form <old_res><chain><res_num><new_res> (e.g. FA25A)

`<interface>` is the chains that define the interface separated by _ (e.g. A_B)

`<ensemble_path>` is the directory containing the ensemble of pdb files representing the mutation (e.g. example/mutations/1A22_FA25A_ensemble)

# Example compilation and execution
## Single State Model
```
g++ predict_ddg.cpp -std=c++11 -o eppi_ddg && ./eppi_ddg example/inputs/1A22.pdb QB416A A_B example/output
```
## Ensemble Model
```
g++ predict_ddg_ensemble.cpp -std=c++11 -o eppi_ddg_ensemble && ./eppi_ddg_ensemble example/inputs/1A22.pdb FA25A A_B example/mutations/1A22_FA25A_ensemble
```

# Example output
The output of the program is a series of files in the specified output directory. The files are as follows:
- `features.txt`: The file containing the interactions at the interface.
- `rosetta_interface_score.sc`: The file containing the Rosetta interface score generated by the InterfaceAnalyzer application.
- `rosetta_residue_scores.sc`: The file containing the Rosetta residue energy breakdown generated by the residue_energy_breakdown application.
- `log.txt`: The file containing the log of the program execution.
- `rosetta_output.out`: The file containing the output of the Rosetta applications.

The final ddg value is returned as a float from the PROTOCOL::EPPI_ddg_ensemble method in the cpp code as well as printed to the screen. 

# Paper Analysis
The EPPI_ddg model was trained on a set of 2421 mutations from 163 complexes. The analysis performed in the paper can be found in the `paper_analysis` directory. Transfer learning can be performed by generating experimental $$\Delta\Delta G$$ values for a set of mutations and then retraining the model using the `train_full_model.py` script. The training script used in the paper is provided in the `model_training` directory. The training set can be found in the `data` directory.

# Reference Papers
link to EPPI_ddg paper

- Richard, A.C. and Pantazes, R.J. (2025). *Using Short Molecular Dynamics Simulations to Determine the Important Features of Interactions in Antibodyâ€“Protein Complexes.* Proteins, 93: 812-830. (https://doi.org/10.1002/prot.26773)


